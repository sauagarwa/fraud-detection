# PIPELINE DEFINITION
# Name: deploy
components:
  comp-deploy-model:
    executorLabel: exec-deploy-model
deploymentSpec:
  executors:
    exec-deploy-model:
      container:
        args:
        - env && oc process -f https://raw.githubusercontent.com/sauagarwa/fraud-detection/main/deployment/inference-server-deployment.yaml
          -p INFERENCE_SERVER_NAME=fraud-detection-is -p AWS_ACCESS_KEY_ID={AWS_ACCESS_KEY_ID}
          -p AWS_SECRET_ACCESS_KEY={AWS_SECRET_ACCESS_KEY} -p AWS_S3_ENDPOINT={AWS_S3_ENDPOINT}
          -p AWS_DEFAULT_REGION={AWS_DEFAULT_REGION} -p AWS_S3_BUCKET={AWS_S3_BUCKET}
          | oc create -f -
        command:
        - /bin/sh
        - -c
        image: quay.io/redhat-ai-dev/utils:latest
pipelineInfo:
  name: deploy
root:
  dag:
    tasks:
      deploy-model:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-deploy-model
        taskInfo:
          name: deploy-model
schemaVersion: 2.1.0
sdkVersion: kfp-2.9.0
---
platforms:
  kubernetes:
    deploymentSpec:
      executors:
        exec-deploy-model:
          secretAsEnv:
          - keyToEnv:
            - envVar: AWS_ACCESS_KEY_ID
              secretKey: AWS_ACCESS_KEY_ID
            - envVar: AWS_SECRET_ACCESS_KEY
              secretKey: AWS_SECRET_ACCESS_KEY
            - envVar: AWS_DEFAULT_REGION
              secretKey: AWS_DEFAULT_REGION
            - envVar: AWS_S3_BUCKET
              secretKey: AWS_S3_BUCKET
            - envVar: AWS_S3_ENDPOINT
              secretKey: AWS_S3_ENDPOINT
            secretName: aws-connection-my-storage
